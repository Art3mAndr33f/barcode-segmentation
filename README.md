# Barcode Segmentation MLOps Project

MLOps –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Detectron2 –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π pipeline –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –∑–∞–¥–∞—á–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Mask R-CNN –Ω–∞ –±–∞–∑–µ ResNet-50
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å DVC
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ MLflow
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π training pipeline —Å PyTorch Lightning
- –≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π –≤ ONNX –∏ TensorRT –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–ú–æ–¥–µ–ª—å**: Detectron2 (Mask R-CNN + ResNet-50)
- **Framework**: PyTorch Lightning
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏**: Poetry
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: DVC
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Hydra
- **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã**: MLflow
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: pre-commit, black, isort, flake8
- **–≠–∫—Å–ø–æ—Ä—Ç**: ONNX, TensorRT

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
barcode_segmentation/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                    # –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (.jpg) –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (.jpg.json)
‚îÇ   ‚îú‚îÄ‚îÄ processed/              # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ interim/                # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ src/barcode_segmentation/   # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ data/                   # –ú–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # –ú–æ–¥–µ–ª–∏ –∏ training
‚îÇ   ‚îî‚îÄ‚îÄ utils/                  # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ configs/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã Hydra
‚îú‚îÄ‚îÄ scripts/                    # –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ commands.py                 # CLI –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ pyproject.toml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Poetry
‚îî‚îÄ‚îÄ dvc.yaml                   # Pipeline DVC
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/YOUR_USERNAME/barcode_segmentation.git
cd barcode_segmentation

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
poetry install

# –î–ª—è Windows: —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ detectron2
python install_detectron2.py
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ data/raw/:
# - .jpg —Ñ–∞–π–ª—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
# - .jpg.json —Ñ–∞–π–ª—ã (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
dvc init
dvc add data/raw
git add data/raw.dvc data/.gitignore
git commit -m "Add raw data to DVC"
```

### 3. –ó–∞–ø—É—Å–∫ pipeline

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ –≤ editable —Ä–µ–∂–∏–º–µ
pip install -e .

# –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
python commands.py preprocess

# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
python commands.py train

# –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
python commands.py infer
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç–µ MLflow UI:

```bash
mlflow server --host 127.0.0.1 --port 8080
```

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://127.0.0.1:8080

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `python commands.py preprocess` | –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö |
| `python commands.py train` | –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ MLflow |
| `python commands.py infer` | –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| `python commands.py convert_to_onnx` | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –≤ ONNX |
| `python commands.py convert_to_tensorrt` | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è TensorRT |

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ ModuleNotFoundError

```bash
# –†–µ—à–µ–Ω–∏–µ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
pip install -e .

# –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Poetry
poetry run python commands.py <–∫–æ–º–∞–Ω–¥–∞>

# –†–µ—à–µ–Ω–∏–µ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PYTHONPATH
set PYTHONPATH=%CD%\src  # Windows
export PYTHONPATH=$PWD/src  # Linux/Mac
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å DVC

```bash
# –ï—Å–ª–∏ DVC —Ñ–∞–π–ª –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .gitignore –∏ —É–¥–∞–ª–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞ data/ –∏–ª–∏ data/raw/
git check-ignore -v data/raw

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC
dvc add data/raw
git add data/raw.dvc data/.gitignore
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Detectron2 –Ω–∞ Windows

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
python install_detectron2.py

# –ò–ª–∏ —Ä—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
poetry shell
pip install detectron2 -f https://dl.fbaipublicfiles.com/detectron2/wheels/cpu/torch1.10/index.html
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∞

–ü—Ä–æ–µ–∫—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **IoU (Intersection over Union)**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- **Modified IoU**: –∫–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤
- **Loss**: —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è
- **mAP**: —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–∞—Ö IoU

## üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç

### –≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏

```bash
# ONNX –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏
python commands.py convert_to_onnx

# TensorRT –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ NVIDIA GPU
python commands.py convert_to_tensorrt
```

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t barcode-segmentation .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 8000:8000 barcode-segmentation
```